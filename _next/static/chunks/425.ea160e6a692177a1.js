"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[425],{5471:function(e,t,r){r.d(t,{Z:function(){return MDX_Card}});var n=r(7294),a=r(3235),o=(0,r(2854).zo)("div",{paddingBottom:"$gr4",zIndex:"1","@md":{paddingBottom:"$gr3"},"@xs":{paddingBottom:"$gr2"}});r(6803),r(2794),r(3981);var i=r(633),l=r(5893),MDX_Card=function(e){var t=e.iiifContent,r=e.label,c=(0,n.useState)(),s=c[0],u=c[1];return((0,n.useEffect)(function(){if(t){var e=i.find(function(e){return e.id===t});e&&u({id:t,type:"Manifest",label:r||e.label,thumbnail:e.thumbnail,homepage:[{id:"/works/".concat(e.slug),label:e.label,type:"Text"}]})}},[t,r,i]),s)?(0,l.jsx)(o,{"data-testid":"mdx-card",children:(0,l.jsx)(a.Z,{resource:s})}):null}},5721:function(e,t,r){r.r(t),r.d(t,{default:function(){return Map_Map}});var n=r(7812),a=r(9499);r(9369),r(9429),r(3656);var o=r(3245),i=r(5715),l=r(9635),c=r(2013),s=r(5996),u=r(577),p=r(2604),d=r(2469),f=r(7294),h=r(5471),g=(0,r(2854).zo)("div",{height:"100vh",width:"100%",position:"fixed",zIndex:"0",top:"0",".map-container":{height:"100%",width:"100%",backgroundColor:"var(--gray-1)",figure:{width:"100%",margin:"0",padding:"0"}},html:{overflow:"hidden"},"html.dark .leaflet-layer":{filter:"invert(100%) hue-rotate(180deg) brightness(90%) contrast(90%)"},".leafletPopupContentWrapper":{backgroundColor:"var(--gray-2)"},".leafletPopupContent":{margin:0},".leafletPopupTip":{backgroundColor:"var(--accent-a10)"},".leaflet-popup":{width:"240px"},".leaflet-popup-content-wrapper":{backgroundColor:"var(--gray-2)",overflow:"hidden",border:"none"},".leaflet-popup-content":{margin:"0",img:{maxHeight:"100% !important"}},".leaflet-popup-tip":{backgroundColor:"var(--accent-a10)",opacity:"0.2"},".leaflet-control":{backgroundColor:"var(--accent-10)"},".leaflet-control-layers":{display:"none"},".leaflet-bar a":{backgroundColor:"var(--accent-10)",color:"var(--gray-12)",fill:"var(--gray-12)"},".canopy-marker-image":{border:"2px solid #000"},".canopyMapPopup":{width:"240px",img:{maxHeight:"100% !important"}},figure:{img:{width:"100%",maxHeight:"200px"},video:{display:"none"}}}),m=r(7191);r(5732);var v=r(5243),b=r.n(v),y=r(8806);function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach(function(t){(0,a.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var createClusterCustomIcon=function(e){var t=e.getChildCount();return b().divIcon({className:"canopy-map-cluster-group-icon",html:'<button data-accent-color="" data-radius="full" style="box-shadow: var(--shadow-3); cursor: pointer; outline-style: none" class="rt-reset rt-BaseButton rt-r-size-3 rt-variant-solid rt-IconButton"><span class="rt-Text rt-r-size-4 rt-r-weight-bold">'.concat(t,"</span></button>"),iconSize:b().point(40,40,!0),iconAnchor:[20,40],popupAnchor:[0,-40]})},x=(0,y.Au)(function(e,t){(0,m.Z)(e);var r=b().markerClusterGroup({iconCreateFunction:createClusterCustomIcon,polygonOptions:{weight:2,opacity:1}});return{instance:r,context:_objectSpread(_objectSpread({},t),{},{layerContainer:r})}}),j=r(7459),pushToDataLayer=function(e){window.dataLayer&&window.dataLayer.push(e)},w=r(5049),getLabel=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";if(!e)return["Untitled"];if("string"==typeof e)return[e];if(!e[t]){var r=Object.getOwnPropertyNames(e);if(r.length>0)return e[r[0]]}return e[t]},O=r(5893);function Map_ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Map_objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Map_ownKeys(Object(r),!0).forEach(function(t){(0,a.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Map_ownKeys(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var k={defaultBounds:[[51.505,-.09]],tileLayers:[{name:"OpenStreetMap",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}]},parseNavDate=function(e){if(!e)return null;if("string"==typeof e){var t=new Date(e);return isNaN(t.getTime())?null:t}if(Array.isArray(e)&&e.length>0){var r=new Date(e[0]);return isNaN(r.getTime())?null:r}if("object"==typeof e&&e.value){var n=new Date(e.value);return isNaN(n.getTime())?null:n}return null},trackMarkerClick=function(e,t,r){var n,a;pushToDataLayer({event:"marker_click",event_category:"map_interaction",event_label:(null===(n=getLabel(null==t?void 0:null===(a=t.properties)||void 0===a?void 0:a.label))||void 0===n?void 0:n[0])||e.id,manifest_id:e.id,feature_index:r,latitude:t.geometry.coordinates[1],longitude:t.geometry.coordinates[0]})},Map_Map=function(e){var t=e.manifests,r=(0,f.useState)(k.tileLayers[0]),a=r[0],m=r[1],v=k.defaultBounds,y=(0,f.useRef)(null),C=(0,f.useState)(v),S=C[0],D=C[1],P=(0,f.useState)([0,0]),z=P[0],M=P[1],_=(0,f.useMemo)(function(){var e=t.map(function(e){return Map_objectSpread(Map_objectSpread({},e),{},{parsedDate:parseNavDate(e.navDate)})}).filter(function(e){return null!==e.parsedDate});if(0===e.length)return{minYear:new Date().getFullYear(),maxYear:new Date().getFullYear(),manifestsWithDates:t};var r=e.map(function(e){return e.parsedDate.getFullYear()});return{minYear:Math.min.apply(Math,(0,n.Z)(r)),maxYear:Math.max.apply(Math,(0,n.Z)(r)),manifestsWithDates:e}},[t]),B=_.minYear,L=_.maxYear,T=_.manifestsWithDates;(0,f.useEffect)(function(){M([B,L])},[B,L]);var N=(0,f.useMemo)(function(){return t.filter(function(e){var t=parseNavDate(e.navDate);if(!t)return!0;var r=t.getFullYear();return r>=z[0]&&r<=z[1]})},[t,z]);(0,f.useEffect)(function(){var e=(0,j.z)(N);e.length>0&&D(e)},[N]),(0,f.useEffect)(function(){y.current&&S&&y.current.fitBounds(S)},[y,S]);var handlePopupOpen=function(e){var t=e.popup,r=y.current;r&&t&&(setTimeout(function(){if(t.update(),t.isOpen()){var e=t.getLatLng();r.panTo(e,{animate:!0})}},50),setTimeout(function(){t.isOpen()&&t.update()},200))};return(0,O.jsx)(g,{css:{top:w.J9,height:"calc(100vh - ".concat(w.J9,"px)")},children:(0,O.jsxs)(i.h,{className:"map-container",bounds:S,scrollWheelZoom:!0,zoomControl:!1,ref:y,children:[(0,O.jsx)(o.Box,{style:{position:"absolute",zIndex:1e3,top:0,right:0,padding:"var(--space-5)"},children:(0,O.jsxs)(o.Flex,{gap:"4",children:[k.tileLayers.length>1&&(0,O.jsxs)(o.Select.Root,{defaultValue:a.name,onValueChange:function(e){var t=k.tileLayers.find(function(t){return t.name===e});t&&m(t)},size:"3",children:[(0,O.jsx)(o.Select.Trigger,{style:{boxShadow:"var(--shadow-3)",background:"var(--gray-1)"}}),(0,O.jsx)(o.Select.Content,{children:(0,O.jsxs)(o.Select.Group,{children:[(0,O.jsx)(o.Select.Label,{children:"Layers"}),k.tileLayers.map(function(e,t){return(0,O.jsx)(o.Select.Item,{value:e.name,children:e.name},t)})]})})]}),(0,O.jsxs)(o.Flex,{direction:"column",gap:"2",children:[(0,O.jsx)(o.IconButton,{"aria-label":"zoom in",size:"3",onClick:function(){var e;return null===(e=y.current)||void 0===e?void 0:e.zoomIn()},style:{boxShadow:"var(--shadow-3)",cursor:"pointer"},children:(0,O.jsx)(d.pOD,{})}),(0,O.jsx)(o.IconButton,{"aria-label":"zoom out",size:"3",onClick:function(){var e;return null===(e=y.current)||void 0===e?void 0:e.zoomOut()},style:{boxShadow:"var(--shadow-3)",cursor:"pointer"},children:(0,O.jsx)(d.V_R,{})})]})]})}),T.length>0&&B!==L&&(0,O.jsx)(o.Box,{style:{position:"absolute",zIndex:1e3,bottom:0,left:0,right:0,padding:"var(--space-5)",background:"var(--gray-1)",borderTop:"1px solid var(--gray-6)",boxShadow:"var(--shadow-3)"},children:(0,O.jsxs)(o.Flex,{direction:"column",gap:"3",children:[(0,O.jsxs)(o.Flex,{justify:"between",align:"center",children:[(0,O.jsxs)(o.Text,{size:"2",weight:"medium",children:["Date Range: ",z[0]," - ",z[1]]}),(0,O.jsxs)(o.Text,{size:"1",color:"gray",children:[N.length," of ",t.length," items"]})]}),(0,O.jsx)(o.Box,{className:"custom-slider",children:(0,O.jsx)(o.Slider,{value:z,onValueChange:function(e){M([e[0],e[1]])},min:B,max:L,step:1,minStepsBetweenThumbs:1,style:{width:"100%"}})}),(0,O.jsxs)(o.Flex,{justify:"between",children:[(0,O.jsx)(o.Text,{size:"1",color:"gray",children:B}),(0,O.jsx)(o.Text,{size:"1",color:"gray",children:L})]})]})}),(0,O.jsx)(l.et,{position:"bottomright",children:(0,O.jsx)(l.et.BaseLayer,{name:a.name,checked:!0,children:(0,O.jsx)(c.I,{url:a.url,attribution:a.attribution})})}),(0,O.jsx)(x,{children:(0,O.jsx)(s.$,{children:N.map(function(e){return e.features.map(function(t,r){var n,a,o,i;return(0,O.jsx)(u.J,{position:[t.geometry.coordinates[1],t.geometry.coordinates[0]],icon:(o=e.thumbnail[0].id,i=getLabel(null==t?void 0:null===(n=t.properties)||void 0===n?void 0:n.label),b().divIcon({className:"canopy-map-marker-icon",html:'<button data-accent-color="" data-radius="full" style="box-shadow: var(--shadow-3); cursor: pointer; outline-style: none;" class="rt-reset rt-BaseButton rt-r-size-2 rt-variant-solid rt-IconButton"><img class="canopy-marker-image" src="'.concat(o,'" alt="').concat(i,'" style="height: 100%; width: 100%; border-radius: 50%; object-fit: cover;" /></button>').toString(),iconSize:b().point(32,32,!0),iconAnchor:[16,32],popupAnchor:[0,-32]})),eventHandlers:{popupopen:handlePopupOpen,click:function(){console.log("Marker clicked!"),trackMarkerClick(e,t,r)}},children:(0,O.jsx)(p.G,{className:"canopy-map-popup",autoPan:!0,autoPanPadding:[20,20],autoPanPaddingTopLeft:[20,20],autoPanPaddingBottomRight:[20,20],keepInView:!0,children:(0,O.jsx)(h.Z,{iiifContent:e.id,label:getLabel(null==t?void 0:null===(a=t.properties)||void 0===a?void 0:a.label)})})},"".concat(e.id,"-").concat(r,"-").concat(z[0],"-").concat(z[1]))})})})},"cluster-".concat(N.length,"-").concat(z[0],"-").concat(z[1]))]})})}}}]);